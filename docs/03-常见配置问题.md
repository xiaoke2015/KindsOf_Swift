#  03-常见配置问题

## 网络配置

❓ 问题：ATS（App Transport Security）配置

### 现象

- HTTP 请求失败，错误提示 ATS 阻止
- 第三方服务无法连接
- 审核被拒（滥用 ATS 例外）

### 解决方案

#### 1. 完全关闭 ATS（不推荐）
```xml
<!-- Info.plist -->
<key>NSAppTransportSecurity</key>
<dict>
    <key>NSAllowsArbitraryLoads</key>
    <true/>
</dict>

```

#### 2. 针对特定域名例外（推荐）

```xml
<!-- Info.plist -->
<key>NSAppTransportSecurity</key>
<dict>
    <key>NSExceptionDomains</key>
    <dict>
        <key>example.com</key>
        <dict>
            <key>NSExceptionAllowsInsecureHTTPLoads</key>
            <true/>
            <key>NSIncludesSubdomains</key>
            <true/>
        </dict>
    </dict>
</dict>
```

#### 3. 仅允许特定 HTTP 方法

```xml
<!-- Info.plist -->
<key>NSAppTransportSecurity</key>
<dict>
    <key>NSAllowsArbitraryLoadsInWebContent</key>
    <true/>
</dict>
```


## 加密许可

❓ 问题：出口合规配置（Export Compliance）

### 现象

- 上传应用到 App Store Connect 时被拒绝
- 提示需要提供出口合规信息
- 审核时间延长

### 解决方案

#### 1. 使用标准加密（大多数应用）
```xml
<!-- Info.plist -->
<key>ITSAppUsesNonExemptEncryption</key>
<false/>
```


#### 2. 使用非标准或自定义加密

```xml
<!-- Info.plist -->
<key>ITSAppUsesNonExemptEncryption</key>
<true/>
```

### 判断标准

- `false`: 仅使用 iOS 系统提供的加密（TLS、CommonCrypto 等）
- `true`: 使用自定义加密算法或非标准实现

### 审核流程

1. 设置正确的 ITSAppUsesNonExemptEncryption 值
2. 在 App Store Connect 中如实回答出口合规问题
3. 必要时提供加密分类说明

## 权限配置

❓ 问题：审核被拒 - 权限描述不清晰

### 现象

- App Store 审核被拒
- 提示"权限使用目的描述不明确"
- 用户不理解为什么需要该权限

### 解决方案

```xml
<!-- Info.plist 配置 -->
<!-- 相机权限 -->
<key>NSCameraUsageDescription</key>
<string>用于扫描二维码和拍摄商品照片，以便快速识别和分享</string>

<!-- 相册权限 -->
<key>NSPhotoLibraryUsageDescription</key>
<string>用于保存和选择图片，方便您编辑个人头像和分享内容</string>

<!-- 位置权限 -->
<key>NSLocationWhenInUseUsageDescription</key>
<string>用于为您推荐附近的商家和服务，提供更精准的推荐</string>

<!-- 麦克风权限 -->
<key>NSMicrophoneUsageDescription</key>
<string>用于视频录制和语音消息功能，让您能够发送语音内容</string>

<!-- 位置 -->
<key>NSLocationWhenInUseUsageDescription</key>
<string>[描述使用时位置权限用途]</string>
<key>NSLocationAlwaysAndWhenInUseUsageDescription</key>
<string>[描述始终位置权限用途]</string>
<key>NSLocationAlwaysUsageDescription</key>
<string>[描述后台位置权限用途]</string>

<!-- 通讯录 -->
<key>NSContactsUsageDescription</key>
<string>[描述通讯录用用途]</string>

<!-- 麦克风 -->
<key>NSMicrophoneUsageDescription</key>
<string>[描述麦克风用途]</string>

<!-- 日历 -->
<key>NSCalendarsUsageDescription</key>
<string>[描述日历用途]</string>

<!-- 提醒事项 -->
<key>NSRemindersUsageDescription</key>
<string>[描述提醒事项用途]</string>

<!-- 运动与健身 -->
<key>NSMotionUsageDescription</key>
<string>[描述运动数据用途]</string>

<!-- 健康数据 -->
<key>NSHealthShareUsageDescription</key>
<string>[描述健康数据读取用途]</string>
<key>NSHealthUpdateUsageDescription</key>
<string>[描述健康数据写入用途]</string>

<!-- 蓝牙 -->
<key>NSBluetoothAlwaysUsageDescription</key>
<string>[描述蓝牙用途]</string>
<key>NSBluetoothPeripheralUsageDescription</key>
<string>[描述蓝牙外设用途]</string>

<!-- 本地网络 -->
<key>NSLocalNetworkUsageDescription</key>
<string>[描述本地网络用途]</string>

<!-- 跟踪权限 (iOS 14+) -->
<key>NSUserTrackingUsageDescription</key>
<string>[描述数据跟踪用途]</string>
```

## 主题与外观配置

❓ 问题：强制应用使用浅色/深色主题

### 现象

- 应用主题与系统设置不一致，用户体验不统一
- 需要特定品牌主题要求的应用（如金融、企业应用）
- 避免深色模式下的适配问题

### 解决方案

#### 1. 强制浅色主题

```xml
<!-- Info.plist -->
<key>UIUserInterfaceStyle</key>
<string>Light</string>
```

#### 2. 强制深色主题

```xml
<!-- Info.plist -->
<key>UIUserInterfaceStyle</key>
<string>Dark</string>
```


#### 3. 跟随系统设置（默认）

```xml
<!-- Info.plist -->
<key>UIUserInterfaceStyle</key>
<string>Automatic</string>
```

## 设计兼容性配置

❓ 问题：适配旧版本 iOS 系统的设计兼容性

### 现象

- 应用在旧版本 iOS 上出现界面错乱或布局问题
- 需要使用旧版 UI 组件或设计语言
- 新版本 iOS 的设计特性在旧系统上不兼容

### 解决方案

```xml
<!-- Info.plist -->
<key>UIDesignRequiresCompatibility</key>
<true/>
```

### 使用场景

- 临时调试：用于在最新SDK中审查和优化UI设计，但官方建议仅在开发阶段使用
- 兼容性调整：确保应用在iOS 26及更高版本中保持现有UI渲染效果

## URL Scheme

❓ 问题：白名单配置

**现象

- canOpenURL 返回 false
- 应用间跳转失败

### 解决方案

```xml
<!-- Info.plist 配置 -->
<key>LSApplicationQueriesSchemes</key>
<array>
    <!-- 社交类 -->
    <string>weixin</string>
    <string>wechat</string>
    <string>mqq</string>
    <string>mqqapi</string>
    <string>mqqopensdk</string>
    
    <!-- 支付类 -->
    <string>alipay</string>
    <string>alipays</string>
    <string>uppaysdk</string>
    <string>uppaywallet</string>
    
    <!-- 地图导航 -->
    <string>iosamap</string>
    <string>baidumap</string>
    <string>comgooglemaps</string>
    <string>qqmap</string>
    
    <!-- 系统应用 -->
    <string>tel</string>
    <string>sms</string>
    <string>mailto</string>
    
    <!-- 其他常用 -->
    <string>dianping</string>
    <string>imeituan</string>
    <string>taobao</string>
</array>
```
